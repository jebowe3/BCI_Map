<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Iowa Points of Interest</title>
  <!-- load leaflet.css library here -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
  <!-- mapbox assembly css for slider and temporal legend styles -->
  <link href='https://api.mapbox.com/mapbox-assembly/v0.8.0/assembly.min.css' rel='stylesheet'>
  <!--for icon support-->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.14.0/css/all.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.14.0/css/v4-shims.css">
  <!-- for icon markers -->
  <link rel="stylesheet" href="css/leaflet.extra-markers.min.css">
  <!-- add custom css styles here -->
  <style>
    /* style the body of the page here */
    body {
      font-family: sans-serif;
      margin: 0px;
      height: 100%;
      width: 100%;
    }

    /* style header */
    header {
      position: fixed;
      top: 12px;
      left: 70px;
      width: 260px;
      height: 50px;
      background-color: rgba(255, 255, 255, 1.0);
      box-shadow: 0px 0px 0px 2px rgba(0, 0, 0, 0.2);
      border-radius: 3px;
      z-index: 800;
    }

    /* style the div with an id of "map" here */
    #map {
      position: absolute;
      width: 100%;
      top: 0;
      bottom: 0;
    }

    /* style the slider control */
    #slider {
      position: absolute;
      height: 43px;
      bottom: 0px;
      left: 120px;
      z-index: 1000;
      background-color: white;
      border-left: 1px solid;
      border-right: 1px solid;
      border-top: 1px solid;
      border-bottom: 1px solid
    }

    /* style the temporal legend */
    #temporal {
      background-color: white;
      height: 43px
    }

    /* style the time selection control */
    #time-select {
      position: absolute;
      bottom: 11px;
      left: 465px;
      z-index: 1000;
      padding: 0.54em;
      background: rgba(255, 255, 255, 1.0);
      box-shadow: 0px 0px 0px 1px rgba(192, 192, 192, 1.0);
    }

    #time-select input {
      display: inline-block;
      border: 1px solid #999;
      font-size: 14px;
      border-radius: 4px;
      height: 18px;
      line-height: 18px;
      width: 50px;
    }

    #time-select input[type='submit'] {
      box-sizing: content-box;
      padding: 0 1em;
      text-transform: uppercase;
      color: white;
      background: #5C7DB8;
      border-color: #5C7DB8;
    }

    /* the text inputs */
    h1 {
      color: black;
      font-size: 18px;
      display: inline-block;
      margin-top: 0.25em;
      margin-bottom: 0.0em;
      margin-left: 0.5em;
      margin-right: 0;
      font-weight: bold;
      text-transform: uppercase;
    }

    h2 {
      color: black;
      font-size: 12px;
      display: inline-block;
      margin-top: 0.0em;
      margin-bottom: 0.0em;
      margin-left: 0.75em;
      margin-right: 0;
    }

    .leaflet-popup-content-wrapper {
      line-height: 10px;
      border-radius: 2px;
      height: 10 px;
      max-height: 300px;
      overflow: auto;
    }

    .leaflet-popup {
      position: absolute;
      text-align: center;
    }

    .leaflet-popup-content {
      min-width: 100 px !important;
    }

    hr.someClass {
      width: 100%;
      height: 6px;
      border-top: 1px solid black
    }
  </style>
</head>

<body>
  <!-- header -->
  <header>
    <h1>Map Name Here</h1><br>
    <h2>A project of the Beloved Community Initiative</h2>
  </header>
  <!-- end header -->
  <!-- define a div called "map" here -->
  <div id="map"></div>
  <!-- ui slider -->
  <div id='slider' class='range w300 round py6 border--gray-light px12 leaflet-control'>
    <input type='range' min="1700" max="2020" value="1700" step="1" class="slider" />
  </div>
  <!-- end slider -->
  <!-- temporal legend -->
  <div id='temporal' class='py12 px12 border border--gray-light round bottom left wmax200'>
    <h3 class='txt-bold'>Year: <span class="spanTxt"></span></h3>
  </div>
  <!-- end temporal -->
  <!-- time select control -->
  <div id="time-select" class="leaflet-bar">
    <form action="#" id="form">
      <label for="year">
        Year
        <input id="year" type="year" name="year">
      </label>
      <input type="submit" value="Update">
    </form>
  </div>
  <!-- load leaflet.js library here -->
  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
  <!--d3js for requesting files into web application-->
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <!-- jquery for easy access to divs -->
  <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
  <!-- for icon markers -->
  <script src="js/leaflet.extra-markers.min.js"></script>
  <!-- papaparse for bringing in google spreadsheet data -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js "></script>
  <!-- javascript here -->
  <script>
    // map options
    const options = {
      center: [42, -93], // center on Iowa
      zoom: 8 // set initial zoom to 8
    };

    // instantiate Leaflet map
    const map = L.map('map', options);

    // Set the currentYear to whatever value is in the slider on load
    let currentYear = $('.slider').val();

    // define the year input form
    const timeForm = document.getElementById('form');

    // use the Jawg Sunny base map - nice, clean, not fussy
    L.tileLayer('https://{s}.tile.jawg.io/jawg-sunny/{z}/{x}/{y}{r}.png?access-token=odaScIS8yTVoAy0mjYBoHMXXasRTvbpjrTyjwQiZutN3FU3WE82xJ6FyqbbglesB', {
      attribution: '<a href="http://jawg.io" title="Tiles Courtesy of Jawg Maps" target="_blank">&copy; <b>Jawg</b>Maps</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
      minZoom: 0,
      maxZoom: 22,
      subdomains: 'abcd',
      accessToken: 'odaScIS8yTVoAy0mjYBoHMXXasRTvbpjrTyjwQiZutN3FU3WE82xJ6FyqbbglesB'
    }).addTo(map); // add the base map to the map;

    // add a scale bar
    L.control.scale({
      position: 'bottomright' // position the scale bar at the bottom-left corner
    }).addTo(map);

    // define layer groups
    var episcopalLayer = L.layerGroup();
    var eventLayer = L.layerGroup();
    var peopleLayer = L.layerGroup();
    var townLayer = L.layerGroup();
    var railLayer = L.layerGroup();

    // define the overlays
    const overlays = {
      "Episcopal Churches": episcopalLayer,
      "Events": eventLayer,
      "People": peopleLayer,
      "Populated Places": townLayer,
      "Railroads": railLayer,
    };

    // define a layer control and add the overlays
    const layerControl = L.control.layers(null, overlays, {
      collapsed: false,
    }).addTo(map);

    // retrieve the google sheet
    $.getJSON(
      'https://sheets.googleapis.com/v4/spreadsheets/1fZ71YgNbW0oxMUtao-csfvb5I8GfUqEh3-gVb7JBuZE/values/MainMap?key=AIzaSyA8z0818hSekRC1lgw8ReYmLyt1cgFl1ns'
    ).then(function(sheet) {
      // define the sheet value results
      let res = sheet.values;
      // use papaparse to parse the google doc
      Papa.parse(Papa.unparse(res), {
        // make sure it knows the first row is the header
        header: true,
        // upon completion...
        complete: function(results) {
          // define data
          let data = results.data;
          // iterate through each row
          data.forEach(function(each) {
            // declare empty markers to be updated with later conditions
            let episcopalChurches = L.marker([each.lat, each.long], {
              icon: L.ExtraMarkers.icon({
                icon: 'fas fa-user-circle',
                prefix: 'fas',
                markerColor: 'blue', // give the marker a color
                iconColor: 'rgba(0,0,0,0)', // give the icon in the marker a color
                iconSize: [0, 0],
                shadowSize: [0, 0]
              })
            });
            let eventPoints = L.marker([each.lat, each.long], {
              icon: L.ExtraMarkers.icon({
                icon: 'fas fa-user-circle',
                prefix: 'fas',
                markerColor: 'blue', // give the marker a color
                iconColor: 'rgba(0,0,0,0)', // give the icon in the marker a color
                iconSize: [0, 0],
                shadowSize: [0, 0]
              })
            });
            let peoplePoints = L.marker([each.lat, each.long], {
              icon: L.ExtraMarkers.icon({
                icon: 'fas fa-user-circle',
                prefix: 'fas',
                markerColor: 'blue', // give the marker a color
                iconColor: 'rgba(0,0,0,0)', // give the icon in the marker a color
                iconSize: [0, 0],
                shadowSize: [0, 0]
              })
            });
            let townPoints = L.marker([each.lat, each.long], {
              icon: L.ExtraMarkers.icon({
                icon: 'fas fa-user-circle',
                prefix: 'fas',
                markerColor: 'blue', // give the marker a color
                iconColor: 'rgba(0,0,0,0)', // give the icon in the marker a color
                iconSize: [0, 0],
                shadowSize: [0, 0]
              })
            });
            let railPoints = L.marker([each.lat, each.long], {
              icon: L.ExtraMarkers.icon({
                icon: 'fas fa-user-circle',
                prefix: 'fas',
                markerColor: 'blue', // give the marker a color
                iconColor: 'rgba(0,0,0,0)', // give the icon in the marker a color
                iconSize: [0, 0],
                shadowSize: [0, 0]
              })
            });
            // if the marker is an episcopal church...
            if (each.type == "Episcopal Church") {
              episcopalChurches = L.marker([each.lat, each.long], {
                icon: L.ExtraMarkers.icon({
                  icon: 'fas fa-place-of-worship',
                  prefix: 'fas',
                  markerColor: 'red', // give the marker a color
                  iconColor: 'white' // give the icon in the marker a color
                })
              });

              // declare an empty string variable
              var popImage = "";

              // if the imageLink is present...
              if (each.imageLink != undefined) {
                // define popImage as...
                var popImage = "<br><img src='" + each.imageLink + "'" + "/>";
                // otherwise...
              } else {
                // make sure it remains an empty string
                var popImage = "";
              };

              // bind a popup to each marker
              episcopalChurches.bindPopup("<b>" + each.town + ", Iowa, " + each.startYear + ":</b><br> " + each.event + "<hr class='someClass'>" + each.moreInfo + popImage, {
                closeButton: true,
                //maxWidth: 300,
                //maxHeight: 400,
              });
              // open on mouseover
              episcopalChurches.on('mouseover', function() {
                episcopalChurches.openPopup();
              });
              /*
                            // close on mouseout
                            episcopalChurches.on('mouseout', function() {
                              episcopalChurches.closePopup();
                            });
              */
              // if the currentYear is greater than or equal to the startYear and less than or equal to the endYear
              if (currentYear >= each.startYear && currentYear <= each.endYear) {
                episcopalLayer.addLayer(episcopalChurches); // add the layer to the layer group;
              } else {
                episcopalLayer.removeLayer(episcopalChurches); // remove the layer from the layer group;
              };
              // add the layer group to the map
              episcopalLayer.addTo(map);
            };
            // if the marker is an event...
            if (each.type == "Event") {
              eventPoints = L.marker([each.lat, each.long], {
                icon: L.ExtraMarkers.icon({
                  icon: 'fas fa-calendar-day',
                  prefix: 'fas',
                  markerColor: 'orange', // give the marker a color
                  iconColor: 'white' // give the icon in the marker a color
                })
              });

              // declare an empty string variable
              var popImage = "";

              // if the imageLink is present...
              if (each.imageLink != undefined) {
                // define popImage as...
                var popImage = "<br><img src='" + each.imageLink + "'" + "/>";
                // otherwise...
              } else {
                // make sure it remains an empty string
                var popImage = "";
              };

              // bind a popup to each marker
              eventPoints.bindPopup("<b>" + each.town + ", Iowa, " + each.startYear + ":</b><br> " + each.event + "<hr class='someClass'>" + each.moreInfo + popImage, {
                closeButton: true,
                //maxWidth: 300,
                //maxHeight: 400,
              });
              // open on mouseover
              eventPoints.on('mouseover', function() {
                eventPoints.openPopup();
              });
              /*
                            // close on mouseout
                            eventPoints.on('mouseout', function() {
                              eventPoints.closePopup();
                            });
              */
              // if the currentYear is greater than or equal to the startYear and less than or equal to the endYear
              if (currentYear >= each.startYear && currentYear <= each.endYear) {
                eventLayer.addLayer(eventPoints); // add the layer to the layer group;
              } else {
                eventLayer.removeLayer(eventPoints); // remove the layer from the layer group;
              };
              // add the layer group to the map
              eventLayer.addTo(map);
            };
            // if the marker is a person...
            if (each.type == "Person") {
              peoplePoints = L.marker([each.lat, each.long], {
                icon: L.ExtraMarkers.icon({
                  icon: 'fas fa-user-circle',
                  prefix: 'fas',
                  markerColor: 'blue', // give the marker a color
                  iconColor: 'white' // give the icon in the marker a color
                })
              });

              // declare an empty string variable
              var popImage = "";

              // if the imageLink is present...
              if (each.imageLink != undefined) {
                // define popImage as...
                var popImage = "<br><img src='" + each.imageLink + "'" + "/>";
                // otherwise...
              } else {
                // make sure it remains an empty string
                var popImage = "";
              };

              // bind a popup to each marker
              peoplePoints.bindPopup("<b>" + each.town + ", Iowa, " + each.startYear + ":</b><br> " + each.event + "<hr class='someClass'>" + each.moreInfo + popImage, {
                closeButton: true,
                //maxWidth: 300,
                //maxHeight: 400,
              });
              // open on mouseover
              peoplePoints.on('mouseover', function() {
                peoplePoints.openPopup();
              });
              /*
                            // close on mouseout
                            peoplePoints.on('mouseout', function() {
                              peoplePoints.closePopup();
                            });
              */
              // if the currentYear is greater than or equal to the startYear and less than or equal to the endYear
              if (currentYear >= each.startYear && currentYear <= each.endYear) {
                peopleLayer.addLayer(peoplePoints); // add the layer to the layer group;
              } else {
                peopleLayer.removeLayer(peoplePoints); // remove the layer from the layer group;
              };
              // add the layer group to the map
              peopleLayer.addTo(map);
            };
            // if the marker is a town...
            if (each.type == "Town") {
              townPoints = L.marker([each.lat, each.long], {
                icon: L.ExtraMarkers.icon({
                  icon: 'fas fa-landmark',
                  prefix: 'fas',
                  markerColor: 'green', // give the marker a color
                  iconColor: 'white' // give the icon in the marker a color
                })
              });

              // declare an empty string variable
              var popImage = "";

              // if the imageLink is present...
              if (each.imageLink != undefined) {
                // define popImage as...
                var popImage = "<br><img src='" + each.imageLink + "'" + "/>";
                // otherwise...
              } else {
                // make sure it remains an empty string
                var popImage = "";
              };

              // bind a popup to each marker
              townPoints.bindPopup("<b>" + each.town + ", Iowa, " + each.startYear + ":</b><br> " + each.event + "<hr class='someClass'>" + each.moreInfo + popImage, {
                closeButton: true,
                //maxWidth: 300,
                //maxHeight: 400,
              });
              // open on mouseover
              townPoints.on('mouseover', function() {
                townPoints.openPopup();
              });
              /*
                            // close on mouseout
                            townPoints.on('mouseout', function() {
                              townPoints.closePopup();
                            });
              */
              // if the currentYear is greater than or equal to the startYear and less than or equal to the endYear
              if (currentYear >= each.startYear && currentYear <= each.endYear) {
                townLayer.addLayer(townPoints); // add the layer to the layer group;
              } else {
                townLayer.removeLayer(townPoints); // remove the layer from the layer group;
              };
              // add the layer group to the map
              townLayer.addTo(map);
            };
            // if the marker is a railroad...
            if (each.type == "Railroad") {
              railPoints = L.marker([each.lat, each.long], {
                icon: L.ExtraMarkers.icon({
                  icon: 'fas fa-train',
                  prefix: 'fas',
                  markerColor: 'purple', // give the marker a color
                  iconColor: 'white' // give the icon in the marker a color
                })
              });

              // declare an empty string variable
              var popImage = "";

              // if the imageLink is present...
              if (each.imageLink != undefined) {
                // define popImage as...
                var popImage = "<br><img src='" + each.imageLink + "'" + "/>";
                // otherwise...
              } else {
                // make sure it remains an empty string
                var popImage = "";
              };

              // bind a popup to each marker
              railPoints.bindPopup("<b>" + each.town + ", Iowa, " + each.startYear + ":</b><br> " + each.event + "<hr class='someClass'>" + each.moreInfo + popImage, {
                closeButton: true,
                //maxWidth: 300,
                //maxHeight: 400,
              });
              // open on mouseover
              railPoints.on('mouseover', function() {
                railPoints.openPopup();
              });
              /*
                            // close on mouseout
                            railPoints.on('mouseout', function() {
                              railPoints.closePopup();
                            });
              */
              // if the currentYear is greater than or equal to the startYear and less than or equal to the endYear
              if (currentYear >= each.startYear && currentYear <= each.endYear) {
                railLayer.addLayer(railPoints); // add the layer to the layer group;
              } else {
                railLayer.removeLayer(railPoints); // remove the layer from the layer group;
              };
              // add the layer group to the map
              railLayer.addTo(map);
            };
            createTemporalLegend(currentYear);
            sequenceUI(each, episcopalChurches, eventPoints, peoplePoints, townPoints, railPoints, timeForm); // feeds layers to the time slider
            updateLayers(each, episcopalChurches, eventPoints, peoplePoints, townPoints, railPoints, currentYear); // updates the layers
          }); // end data.forEach
        }
      });
    });

    // add a UI slider
    function sequenceUI(each, episcopalChurches, eventPoints, peoplePoints, townPoints, railPoints, timeForm) {

      // create Leaflet control for the slider
      const sliderControl = L.control({
        position: 'bottomleft',
        follow: true
      });

      // add controls to the slider
      sliderControl.onAdd = function(map) {

        let controls = L.DomUtil.get("slider"); // get the style settings

        // disable map dragging while mouse is pressed over slider
        L.DomEvent.addListener(controls, 'mousedown', function(e) {
          map.dragging.disable();
        });

        // enable map dragging when mouse leaves slider
        L.DomEvent.addListener(controls, 'mouseout', function(e) {
          map.dragging.enable();
        });

        return controls; // return the style settings

      }

      // add the control to the map
      sliderControl.addTo(map);

      // if a year is submitted on timeForm...
      timeForm.addEventListener('submit', function updateTimeRange(e) {
        var currentYear = document.getElementById('year').value; // define currentYear as the submitted year
        $('.slider').val(currentYear); // adjust the time slider to the submitted year
        createTemporalLegend(currentYear); // run this function
        updateLayers(each, episcopalChurches, eventPoints, peoplePoints, townPoints, railPoints, currentYear); // updates the layers
        e.preventDefault(); // prevent defaulting
      });

      $('.slider')
        .on('input change', function() {
          let currentYear = $(this).val(); // identifies the year selected
          createTemporalLegend(currentYear);
          updateLayers(each, episcopalChurches, eventPoints, peoplePoints, townPoints, railPoints, currentYear); // updates the layers
        });

    }; // end sequenceUI function

    // add a temporal legend in sync with the UI slider
    function createTemporalLegend(currentYear) {

      const temporalLegend = L.control({
        position: 'bottomleft' // place the temporal legend at bottom left corner
      });

      // when added to the map
      temporalLegend.onAdd = function(map) {

        let div = L.DomUtil.get("temporal"); // get the style settings

        // disable the mouse events
        L.DomEvent.addListener(div, 'mousedown', function(e) {
          L.DomEvent.stopPropagation(e);
        });

        return div; // return the style settings

      }

      $('#temporal span').html(currentYear); // change grade value to that currently selected by UI slider

      temporalLegend.addTo(map); // add the temporal legend to the map

    }; // end createTemporalLegend function

    // update the layers based on the time slider year
    function updateLayers(each, episcopalChurches, eventPoints, peoplePoints, townPoints, railPoints, currentYear) {

      // if the currentYear is greater than or equal to the startYear and less than or equal to the endYear
      if (currentYear >= each.startYear && currentYear <= each.endYear) {
        episcopalLayer.addLayer(episcopalChurches); // add the layer to the layer group;
        eventLayer.addLayer(eventPoints);
        peopleLayer.addLayer(peoplePoints);
        townLayer.addLayer(townPoints);
        railLayer.addLayer(railPoints);
      } else {
        episcopalLayer.removeLayer(episcopalChurches); // remove the layer from the layer group;
        eventLayer.removeLayer(eventPoints);
        peopleLayer.removeLayer(peoplePoints);
        townLayer.removeLayer(townPoints);
        railLayer.removeLayer(railPoints);
      };

    }; // end updateLayers function

    /*

        // load the data asynchronously
        d3.queue()
          .defer(d3.csv, 'data/iowaFactsheet.csv') // the centroids layer
          .await(drawMap); // load the layers after the map loads

        // define drawMap function
        function drawMap(err, iowaCSV) {

          // build the geojson from the csv data
          const geojson = {
            "type": "FeatureCollection",
            "features": []
          }

          let feature;

          iowaCSV.forEach(function(datum) {

            // add coordinate data as points
            feature = {
              "type": "Feature",
              "geometry": {
                "type": "Point",
                "coordinates": [datum.long, datum.lat]
              },
              "properties": datum
            }

            // push points to a geojson feature collection
            geojson.features.push(feature);

          });

          // define points in a new leaflet layer
          const churches = L.geoJson(geojson, {

            // pointToLayer
            pointToLayer: function(feature, latlng) {
              // If the type property equals "Church"...
              if (feature.properties.type == "Church") {
                // if the currentYear is greater than or equal to the start_year and less than or equal to the end_year
                if (currentYear >= feature.properties.start_year && currentYear <= feature.properties.end_year) {
                  // ...return an extra marker styled with a Font Awesome icon called 'fas fa-place-of-worship'
                  return L.marker(latlng, {
                    icon: L.ExtraMarkers.icon({
                      icon: 'fas fa-place-of-worship',
                      prefix: 'fas',
                      markerColor: 'red', // give the marker a color
                      iconColor: 'white' // give the icon in the marker a color
                    })
                  });
                } else {
                  // ...return an empty marker
                  return L.marker(latlng, {
                    icon: L.ExtraMarkers.icon({
                      icon: 'fas fa-place-of-worship',
                      prefix: 'fas',
                      markerColor: 'red', // give the marker a color
                      iconColor: 'rgba(0,0,0,0)', // give the icon in the marker a color
                      iconSize: [0, 0],
                      shadowSize: [0, 0]
                    })
                  });
                }

              };
            },

            // On each marker...
            onEachFeature: function(feature, layer) {

              // define the layer feature properties
              let props = layer.feature.properties;

              if (currentYear >= props.start_year && currentYear <= props.end_year) {
                // bind info to the layer features using popups
                layer.bindPopup("<b>" + props.town + ", Iowa, " + props.year + ":</b><br> " + props.event + "<hr>" + props.more_info, {
                  closeButton: false
                });
                layer.on('mouseover', function() {
                  layer.openPopup();
                });
                layer.on('mouseout', function() {
                  layer.closePopup();
                });
              } else {
                layer.unbindPopup();
              };

            } // end onEachFeature

          }).addTo(map); // end churches layer

          // define points in a new leaflet layer
          const people = L.geoJson(geojson, {

            // pointToLayer
            pointToLayer: function(feature, latlng) {
              // If the type property equals "Person"...
              if (feature.properties.type == "Person") {
                // if the currentYear is greater than or equal to the start_year and less than or equal to the end_year
                if (currentYear >= feature.properties.start_year && currentYear <= feature.properties.end_year) {
                  // ...return an extra marker styled with a Font Awesome icon called 'fas fa-user-circle'
                  return L.marker(latlng, {
                    icon: L.ExtraMarkers.icon({
                      icon: 'fas fa-user-circle',
                      prefix: 'fas',
                      markerColor: 'blue', // give the marker a color
                      iconColor: 'white' // give the icon in the marker a color
                    })
                  });
                } else {
                  // ...return an empty marker
                  return L.marker(latlng, {
                    icon: L.ExtraMarkers.icon({
                      icon: 'fas fa-user-circle',
                      prefix: 'fas',
                      markerColor: 'blue', // give the marker a color
                      iconColor: 'rgba(0,0,0,0)', // give the icon in the marker a color
                      iconSize: [0, 0],
                      shadowSize: [0, 0]
                    })
                  });
                }

              };
            },

            // on each marker...
            onEachFeature: function(feature, layer) {

              // define the layer feature properties
              let props = layer.feature.properties;

              if (currentYear >= props.start_year && currentYear <= props.end_year) {
                // bind info to the layer features using popups
                layer.bindPopup("<b>" + props.town + ", Iowa, " + props.year + ":</b><br> " + props.event + "<hr>" + props.more_info, {
                  closeButton: false
                });
                layer.on('mouseover', function() {
                  layer.openPopup();
                });
                layer.on('mouseout', function() {
                  layer.closePopup();
                });
              } else {
                layer.unbindPopup();
              };

            } // end onEachFeature

          }).addTo(map); // end people layer

          // define points in a new leaflet layer
          const towns = L.geoJson(geojson, {

            // pointToLayer
            pointToLayer: function(feature, latlng) {
              // If the type property equals "Town"...
              if (feature.properties.type == "Town") {
                // if the currentYear is greater than or equal to the start_year and less than or equal to the end_year
                if (currentYear >= feature.properties.start_year && currentYear <= feature.properties.end_year) {
                  // ...return an extra marker styled with a Font Awesome icon called 'fas fa-landmark'
                  return L.marker(latlng, {
                    icon: L.ExtraMarkers.icon({
                      icon: 'fas fa-landmark',
                      prefix: 'fas',
                      markerColor: 'green', // give the marker a color
                      iconColor: 'white' // give the icon in the marker a color
                    })
                  });
                } else {
                  // ...return an empty marker
                  return L.marker(latlng, {
                    icon: L.ExtraMarkers.icon({
                      icon: 'fas fa-landmark',
                      prefix: 'fas',
                      markerColor: 'green', // give the marker a color
                      iconColor: 'rgba(0,0,0,0)', // give the icon in the marker a color
                      iconSize: [0, 0],
                      shadowSize: [0, 0]
                    })
                  });
                }
              };
            },

            // on each marker...
            onEachFeature: function(feature, layer) {

              // define the layer feature properties
              let props = layer.feature.properties;

              if (currentYear >= props.start_year && currentYear <= props.end_year) {
                // bind info to the layer features using popups
                layer.bindPopup("<b>" + props.town + ", Iowa, " + props.year + ":</b><br> " + props.event + "<hr>" + props.more_info, {
                  closeButton: false
                });
                layer.on('mouseover', function() {
                  layer.openPopup();
                });
                layer.on('mouseout', function() {
                  layer.closePopup();
                });
              } else {
                layer.unbindPopup();
              };

            } // end onEachFeature

          }).addTo(map); // end towns layer

          sequenceUI(churches, people, towns); // feeds layers to the time slider
          createTemporalLegend(currentYear); // produces temporal legend upon map loading
          updateLayers(churches, people, towns, currentYear); // updates the layers

          // define the overlays for the layer control
          const overlays = {
            "Places of Worship": churches,
            "People": people,
            "Populated Places": towns,
          };

          // all done with the layers, add them to layer control
          L.control.layers(null, overlays, {
            collapsed: false,
          }).addTo(map);

        }; // end drawMap function

        // add a UI slider
        function sequenceUI(churches, people, towns) {

          // create Leaflet control for the slider
          const sliderControl = L.control({
            position: 'bottomleft',
            follow: true
          });

          // add controls to the slider
          sliderControl.onAdd = function(map) {

            let controls = L.DomUtil.get("slider"); // get the style settings

            // disable map dragging while mouse is pressed over slider
            L.DomEvent.addListener(controls, 'mousedown', function(e) {
              map.dragging.disable();
            });

            // enable map dragging when mouse leaves slider
            L.DomEvent.addListener(controls, 'mouseout', function(e) {
              map.dragging.enable();
            });

            return controls; // return the style settings

          }

          // add the control to the map
          sliderControl.addTo(map);

          $('.slider')
            .on('input change', function() {
              let currentYear = $(this).val(); // identifies the year selected
              createTemporalLegend(currentYear);
              updateLayers(churches, people, towns, currentYear); // updates the layers
            });

        }; // end sequenceUI function

        // add a temporal legend in sync with the UI slider
        function createTemporalLegend(currentYear) {

          const temporalLegend = L.control({
            position: 'bottomleft' // place the temporal legend at bottom left corner
          });

          // when added to the map
          temporalLegend.onAdd = function(map) {

            let div = L.DomUtil.get("temporal"); // get the style settings

            // disable the mouse events
            L.DomEvent.addListener(div, 'mousedown', function(e) {
              L.DomEvent.stopPropagation(e);
            });

            return div; // return the style settings

          }

          $('#temporal span').html(currentYear); // change grade value to that currently selected by UI slider

          temporalLegend.addTo(map); // add the temporal legend to the map

        }; // end createTemporalLegend function

        // update the layers based on the time slider year
        function updateLayers(churches, people, towns, currentYear) {

          // use the eachLayer method to access all objects of the churches layer
          churches.eachLayer(function(layer) {

            // define properties
            let props = layer.feature.properties;

            if (currentYear >= props.start_year && currentYear <= props.end_year) {
              layer.setIcon(
                L.ExtraMarkers.icon({
                  icon: 'fas fa-place-of-worship',
                  prefix: 'fas',
                  markerColor: 'red', // give the marker a color
                  iconColor: 'white' // give the icon in the marker a color
                })
              );
              // bind info to the layer features using popups
              layer.bindPopup("<b>" + props.town + ", Iowa, " + props.year + ":</b><br> " + props.event + "<hr>" + props.more_info, {
                closeButton: false
              });
              layer.on('mouseover', function() {
                layer.openPopup();
              });
              layer.on('mouseout', function() {
                layer.closePopup();
              });
            } else {
              layer.setIcon(
                L.ExtraMarkers.icon({
                  icon: 'fas fa-place-of-worship',
                  prefix: 'fas',
                  markerColor: 'red', // give the marker a color
                  iconColor: 'rgba(0,0,0,0)', // give the icon in the marker a color
                  iconSize: [0, 0],
                  shadowSize: [0, 0]
                })
              );
              layer.unbindPopup();
            }

          });

          // use the eachLayer method to access all objects of the people layer
          people.eachLayer(function(layer) {

            // define properties
            let props = layer.feature.properties;

            if (currentYear >= props.start_year && currentYear <= props.end_year) {
              layer.setIcon(
                L.ExtraMarkers.icon({
                  icon: 'fas fa-user-circle',
                  prefix: 'fas',
                  markerColor: 'blue', // give the marker a color
                  iconColor: 'white' // give the icon in the marker a color
                })
              );
              // bind info to the layer features using popups
              layer.bindPopup("<b>" + props.town + ", Iowa, " + props.year + ":</b><br> " + props.event + "<hr>" + props.more_info, {
                closeButton: false
              });
              layer.on('mouseover', function() {
                layer.openPopup();
              });
              layer.on('mouseout', function() {
                layer.closePopup();
              });
            } else {
              layer.setIcon(
                L.ExtraMarkers.icon({
                  icon: 'fas fa-user-circle',
                  prefix: 'fas',
                  markerColor: 'blue', // give the marker a color
                  iconColor: 'rgba(0,0,0,0)', // give the icon in the marker a color
                  iconSize: [0, 0],
                  shadowSize: [0, 0]
                })
              );
              layer.unbindPopup();
            }

          });

          // use the eachLayer method to access all objects of the towns layer
          towns.eachLayer(function(layer) {

            // define properties
            let props = layer.feature.properties;

            if (currentYear >= props.start_year && currentYear <= props.end_year) {
              layer.setIcon(
                L.ExtraMarkers.icon({
                  icon: 'fas fa-landmark',
                  prefix: 'fas',
                  markerColor: 'green', // give the marker a color
                  iconColor: 'white' // give the icon in the marker a color
                })
              );
              // bind info to the layer features using popups
              layer.bindPopup("<b>" + props.town + ", Iowa, " + props.year + ":</b><br> " + props.event + "<hr>" + props.more_info, {
                closeButton: false
              });
              layer.on('mouseover', function() {
                layer.openPopup();
              });
              layer.on('mouseout', function() {
                layer.closePopup();
              });
            } else {
              layer.setIcon(
                L.ExtraMarkers.icon({
                  icon: 'fas fa-landmark',
                  prefix: 'fas',
                  markerColor: 'green', // give the marker a color
                  iconColor: 'rgba(0,0,0,0)', // give the icon in the marker a color
                  iconSize: [0, 0],
                  shadowSize: [0, 0]
                })
              );
              layer.unbindPopup();
            }

          });

        }; // end updateLayers function
    */
  </script>
</body>

</html>
